version: "3"

services:
  gitlab:
    image: "gitlab/gitlab-ce:latest"
    hostname: {{gitlab_host}}
    environment:
      GITLAB_OMNIBUS_CONFIG: |
        external_url 'http://fedgitlab.stack.com'
        gitlab_rails['gitlab_shell_ssh_port'] = 2224
        gitlab_rails['initial_root_password'] = "vF8Cc9PikcWwnyKDn4SbfvKmk42XTD4q8RD8C+WpIuc="
        gitlab_rails['display_initial_root_password'] = true
    ports:
      - "443:443"
      - "80:80"
      - "2224:2224"
    volumes:
      - gitlab_config:{{gitlab_config}}
      - gitlab_logs:{{gitlab_logs}}
      - gitlab_data:{{gitlab_data}}
    shm_size: '256m'

volumes:
  gitlab_config:
  gitlab_logs:
  gitlab_data:
